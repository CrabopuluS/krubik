Metadata-Version: 2.4
Name: krubik
Version: 0.2.0
Summary: Full-stack Rubik's Cube solver platform
Author: Krubik Team
Requires-Python: >=3.12
Description-Content-Type: text/markdown
License-File: LICENSE
Requires-Dist: fastapi<1,>=0.111.0
Requires-Dist: uvicorn[standard]<0.31,>=0.29.0
Requires-Dist: httpx<0.28,>=0.27.0
Requires-Dist: python-dotenv<2,>=1.0.1
Requires-Dist: kociemba<2,>=1.2.1
Requires-Dist: structlog<25,>=24.1.0
Requires-Dist: pydantic-settings<3,>=2.2.1
Requires-Dist: slowapi<0.2,>=0.1.9
Provides-Extra: dev
Requires-Dist: black<25,>=24.3.0; extra == "dev"
Requires-Dist: ruff<0.5,>=0.4.5; extra == "dev"
Requires-Dist: mypy<2,>=1.10.0; extra == "dev"
Requires-Dist: pytest<9,>=8.2.0; extra == "dev"
Requires-Dist: pytest-asyncio<0.24,>=0.23.6; extra == "dev"
Requires-Dist: respx<0.22,>=0.21.1; extra == "dev"
Requires-Dist: pytest-cov<6,>=5.0.0; extra == "dev"
Dynamic: license-file

# Krubik

Полноценная платформа для поиска оптимального решения кубика Рубика методом Коцимбы. Репозиторий включает:

- **Backend** — FastAPI (Python 3.12) с валидацией состояний, внешним HTTP‑клиентом, Circuit Breaker, rate limiting и локальным решателем.
- **Frontend** — React 18 + TypeScript + Vite, drag & drop мастер ввода, 3D‑визуализация и панель шагов с анимацией.
- **Инфраструктура** — Docker Compose (backend, frontend, nginx), готовые Make‑таргеты и CI‑пайплайн.

## Требования

- Python 3.12+
- Node.js LTS (20.x)
- Docker 24+ и Docker Compose plugin

## Установка

```bash
make install
cp .env.example .env
```

При необходимости заполните переменные в `.env`.

## Запуск

### Локально (dev-серверы)

```bash
# Backend
uvicorn app.main:app --app-dir backend/app --reload

# Frontend
npm run dev --workspace .
```

### Через Docker Compose

```bash
make dev
```

Перед первым запуском создайте самоподписанный сертификат для `infrastructure/nginx/certs` (см. ниже).

```bash
mkdir -p infrastructure/nginx/certs
openssl req -x509 -nodes -days 365 \
  -subj "/CN=localhost" \
  -newkey rsa:2048 \
  -keyout infrastructure/nginx/certs/dev.key \
  -out infrastructure/nginx/certs/dev.crt
```

## Make-таски

| Команда              | Описание                                            |
| -------------------- | --------------------------------------------------- |
| `make install`       | Установка Python и Node зависимостей                |
| `make lint`          | Ruff + Black + Mypy + ESLint + Prettier (check)     |
| `make format`        | Автоформатирование (Black, Prettier, Ruff fix)      |
| `make test`          | Pytest + Jest                                       |
| `make test-e2e`      | Playwright e2e (desktop + mobile)                   |
| `make dev`           | Запуск docker-compose стека                         |

## Переменные окружения

| Переменная               | Назначение                                          |
| ------------------------ | --------------------------------------------------- |
| `KRUBIK_CORS_ORIGINS`    | Разрешённые Origins для CORS (через запятую)        |
| `KRUBIK_SOLVER_API_URL`  | URL внешнего solver API (может быть пустым)        |
| `KRUBIK_RATE_LIMIT`      | Ограничение запросов (формат SlowAPI, например `10/minute`) |
| `KRUBIK_CSRF_COOKIE`     | Имя cookie для double-submit CSRF                   |
| `KRUBIK_CSRF_HEADER`     | Имя заголовка CSRF                                  |
| `VITE_API_URL`           | URL эндпоинта `/solve` для фронтенда                |

## API

### POST `/solve`

Запрос:

```json
{
  "state": "UUUUUUUUURRRRRRRRRFFFFFFFFFDDDDDDDDDLLLLLLLLLBBBBBBBBB"
}
```

Ответ:

```json
{
  "moves": ["R", "U", "R'", "U'"],
  "source": "external"
}
```

Особенности:

- Валидация длины, распределения цветов и достижимости (через локальный решатель).
- Accept-Language → локализованные сообщения (`ru`, `en`).
- Double-submit CSRF (cookie + заголовок).
- Rate limiting на уровне SlowAPI.
- Логи через structlog без PII (используются хэши состояния).

## Фронтенд

- Drag & drop мастер ввода граней, подсказки и responsive дизайн (≤480px, ≤768px).
- Zustand хранит состояние куба и решения, React Query управляет запросами.
- 3D‑визуализация куба на CSS 3D, панель шагов с автоанимацией.
- Локализация через i18next (RU/EN), всплывающие уведомления об ошибках.

## Тестирование

```bash
make lint
make test            # Pytest + Jest
make test-e2e        # Playwright
```

CI (GitHub Actions) прогоняет `pytest`, `mypy`, `ruff`, `eslint`, `prettier`, `jest`.

## Безопасность и производительность

- CORS whitelist, double-submit CSRF, rate limiting (SlowAPI), маскирование логов.
- HTTPX с таймаутами, retry и Circuit Breaker + локальный fallback решатель.
- LRU-кэш локального решателя, lazy загрузка компонентов, React Query кэширует ответы.
- Статика готова к CDN, Tailwind для адаптивного UI.

## Лицензия

MIT
